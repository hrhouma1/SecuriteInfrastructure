### Partie 02 - *Architecture du TP2 : Haute Disponibilit√© avec Keepalived*

---

### **Pr√©sentation**

L‚Äôexercice pratique repose sur une infrastructure r√©seau visant √† configurer et tester une solution de haute disponibilit√© en utilisant **Keepalived** pour g√©rer une **VIP (Virtual IP)** et une **VGW (Virtual Gateway)**. La configuration est bas√©e sur des machines virtuelles connect√©es √† diff√©rents r√©seaux virtuels (**VMnet**) pour simuler un environnement r√©aliste.

---

### 01 - **Diagramme de l‚ÄôArchitecture**

```
                            +----------------+
                            |     CLIENT      |
                            |  Windows 10 Pro |
                            |-----------------|
                            | VMnet3 (NAT)    |
                            | DHCP            |
                            +-----------------+
                                   |
                          +--------------------+
                          |      Routeur       |
                          |     (PfSense)      |
                          +--------------------+
                         NIC1: NAT (Internet)
                         NIC2: VMnet3 (20.21.22.1/24)
                         NIC3: VMnet2 (10.11.12.254/24)
                                   |
             +---------------------+---------------------+
             |                                           |
  +--------------------+                    +-----------------------+
  |      Master         |                    |        Backup        |
  |    Ubuntu Server    |                    |    Ubuntu Server     |
  |---------------------|                    |----------------------|
  | NIC1: VMnet2 (10.11.12.1/24)            | NIC1: VMnet2 (10.11.12.2/24)
  | NIC2: VMnet4 (192.168.100.1/24)         | NIC2: VMnet4 (192.168.100.2/24)
  | NIC3: VMnet5 (172.168.1.1/30)           | NIC3: VMnet5 (172.168.1.2/30)
  +--------------------+                    +-----------------------+
           |                                             |
    +--------------------+                    +-----------------------+
    |      Noeud1        |                    |         Noeud2        |
    |    Ubuntu Server    |                    |    Ubuntu Server     |
    |---------------------|                    |----------------------|
    | NIC1: VMnet4 (192.168.100.10/24)        | NIC1: VMnet4 (192.168.100.20/24)
    | Default GW: 192.168.100.99              | Default GW: 192.168.100.99
    +--------------------+                    +-----------------------+
```

---

### 02 - **Tableau des R√¥les et Adresses IP**

| **Nom**      | **R√©seau (VMnet)** | **Adresse IP**       | **R√¥le**                         | **Fonctionnalit√©s**                                 |
|--------------|--------------------|----------------------|-----------------------------------|----------------------------------------------------|
| **PfSense**  | VMnet3 (LAN)       | 20.21.22.1/24        | Routeur, DNS, NAT                | Assure le routage entre les r√©seaux.              |
|              | VMnet2 (DMZ)       | 10.11.12.254/24      |                                   |                                                    |
| **Master**   | VMnet2 (DMZ)       | 10.11.12.1/24        | Directeur Principal               | G√®re la VIP et VGW pour les n≈ìuds.                |
|              | VMnet4 (Backend)   | 192.168.100.1/24     |                                   |                                                    |
|              | VMnet5 (Sync)      | 172.168.1.1/30       | Synchronisation                  | Synchronisation Keepalived avec le Backup.        |
| **Backup**   | VMnet2 (DMZ)       | 10.11.12.2/24        | Directeur Secondaire             | Prend le relais en cas de panne du Master.        |
|              | VMnet4 (Backend)   | 192.168.100.2/24     |                                   |                                                    |
|              | VMnet5 (Sync)      | 172.168.1.2/30       | Synchronisation                  | Synchronisation Keepalived avec le Master.        |
| **Noeud1**   | VMnet4 (Backend)   | 192.168.100.10/24    | Serveur R√©el                     | H√©berge des services web.                         |
| **Noeud2**   | VMnet4 (Backend)   | 192.168.100.20/24    | Serveur R√©el                     | H√©berge des services web.                         |
| **VGW**      | VMnet4 (Backend)   | 192.168.100.99/24    | Passerelle Virtuelle             | Assure le routage des requ√™tes Backend.           |
| **VIP**      | VMnet2 (DMZ)       | 10.11.12.99/24       | Virtual IP                       | Adresse virtuelle pour les directeurs Keepalived. |

---

### 03 - **Description des R√©seaux**

1. **VMnet3 (Interne - LAN) :**
   - Connecte le Client et le Routeur.
   - Assure l‚Äôacc√®s Internet via NAT.

2. **VMnet2 (DMZ) :**
   - Connecte les Directeurs (Master et Backup) et le Routeur.
   - H√©berge la **VIP (10.11.12.99)**, qui distribue le trafic.

3. **VMnet4 (Backend) :**
   - Connecte les Directeurs et les N≈ìuds.
   - H√©berge la **VGW (192.168.100.99)** pour assurer la communication.

4. **VMnet5 (Synchronisation) :**
   - Connecte le Master et le Backup uniquement.
   - Permet la synchronisation priv√©e via Keepalived.

---

### Partie 02 - *QUESTIONS*

---

#### **01. Pourquoi utiliser des r√©seaux VMnet distincts dans cette architecture‚ÄØ?**

**R√©ponse :**
- Pour isoler les flux (Interne, DMZ, Backend, et Synchronisation).
- √âvite les conflits de trafic.
- Renforce la s√©curit√© en s√©parant les r√¥les (ex. : DMZ pour le trafic public, Backend pour les services internes).

---

#### **02. Expliquez le r√¥le de la Virtual IP (VIP) dans cette architecture.**

**R√©ponse :**
- La VIP (10.11.12.99) repr√©sente l‚Äôadresse publique du cluster.
- Elle distribue les requ√™tes entrantes entre les Directeurs Master et Backup.
- En cas de panne, Keepalived bascule automatiquement la VIP vers le serveur fonctionnel.

---

#### **03. Quelle est la fonction de la VGW (192.168.100.99) dans le r√©seau Backend‚ÄØ?**

**R√©ponse :**
- La VGW est la passerelle virtuelle utilis√©e par les n≈ìuds Backend.
- Elle redirige le trafic des n≈ìuds vers les Directeurs Master/Backup, selon leur disponibilit√©.

---

#### **04. Pourquoi un r√©seau d√©di√© (VMnet5) est-il n√©cessaire pour la synchronisation‚ÄØ?**

**R√©ponse :**
- Permet de s√©curiser les donn√©es de synchronisation entre le Master et le Backup.
- Emp√™che les perturbations dues au trafic DMZ ou Backend.

---

#### **05. Pourquoi est-il important que les n≈ìuds Backend utilisent la VGW comme passerelle‚ÄØ?**

**R√©ponse :**
- Cela garantit que le trafic est rout√© via les Directeurs (Master/Backup).
- Assure une haute disponibilit√© m√™me en cas de panne d‚Äôun Directeur.

---

#### **06. Si un n≈ìud ne peut pas pinguer la VGW, quelles v√©rifications effectueriez-vous‚ÄØ?**

**R√©ponse :**
1. V√©rifiez la configuration IP du n≈ìud :
   ```bash
   ip route
   ```
2. Assurez-vous que la VGW est active sur le Master ou le Backup.
3. V√©rifiez la connectivit√© r√©seau sur VMnet4.

---

#### **07. Expliquez pourquoi le Routeur est connect√© √† plusieurs r√©seaux VMnet.**

**R√©ponse :**
- **VMnet3 :** Assure l‚Äôacc√®s Internet via NAT.
- **VMnet2 :** Connecte le r√©seau DMZ pour g√©rer le trafic des Directeurs.
- Permet le routage entre les r√©seaux et l‚Äôacc√®s √† Internet.

---

#### **08. Pourquoi est-il n√©cessaire d‚Äôattribuer des adresses IP fixes aux machines‚ÄØ?**

**R√©ponse :**
- Assure une communication stable entre les machines.
- Permet √† Keepalived de fonctionner correctement avec les VIP et VGW.
- Simplifie le d√©pannage et la gestion r√©seau.

---

#### **09. Si le Client ne peut pas acc√©der √† la VIP, quelles √©tapes de diagnostic effectueriez-vous‚ÄØ?**

**R√©ponse :**
1. Pingez la VIP (10.11.12.99) depuis le Client.
2. V√©rifiez que le Master g√®re la VIP (commande `ip addr show`).
3. Testez la connectivit√© entre le Client et VMnet3.

---

#### **10. Expliquez comment Keepalived g√®re le basculement entre Master et Backup.**

**R√©ponse :**
- Keepalived utilise le protocole VRRP pour surveiller la disponibilit√© des Directeurs.
- Si le Master tombe en panne, le Backup prend en charge la VIP et la VGW.

---

Ces 10 questions suivent le style demand√© et couvrent les concepts essentiels li√©s au TP2. Si vous souhaitez davantage de questions sp√©cifiques, je peux en ajouter‚ÄØ! üòä

